<app-main-layout>
  <div class="fade-in max-w-4xl mx-auto">
    <div class="mb-8">
      <a routerLink="/payment" class="text-cnss-primary hover:underline inline-flex items-center mb-4">
        <span class="material-icons mr-1">arrow_back</span>
        {{ i18n.t('forms.backToList') }}
      </a>
      <h1 class="text-3xl font-bold text-cnss-dark">{{ i18n.t('forms.registerPayment') }}</h1>
      <p class="text-gray-600 mt-2">{{ i18n.t('forms.registerPaymentDesc') }}</p>
    </div>

    <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()" class="space-y-6">
      
      <!-- Debit Selection -->
      <div class="card">
        <h2 class="text-xl font-bold text-cnss-dark mb-6 flex items-center">
          <span class="material-icons mr-2 text-cnss-primary">receipt</span>
          {{ i18n.t('forms.selectDebit') }}
        </h2>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            {{ i18n.t('forms.debitToPay') }} <span class="text-red-500">*</span>
          </label>
          <select formControlName="debitId" class="form-field">
            <option value="">{{ i18n.t('forms.selectDebitPlaceholder') }}</option>
            <option *ngFor="let debit of debits" [value]="debit.id">
              {{ debit.label }}
            </option>
          </select>
        </div>
      </div>

      <!-- Payment Information -->
      <div class="card">
        <h2 class="text-xl font-bold text-cnss-dark mb-6 flex items-center">
          <span class="material-icons mr-2 text-cnss-primary">payment</span>
          {{ i18n.t('forms.paymentInfo') }}
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              {{ i18n.t('forms.paymentDate') }} <span class="text-red-500">*</span>
            </label>
            <input type="date" formControlName="paymentDate" class="form-field">
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              {{ i18n.t('payment.amount') }} <span class="text-red-500">*</span>
            </label>
            <input type="number" formControlName="amount" class="form-field" placeholder="0.00">
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              {{ i18n.t('forms.paymentMode') }} <span class="text-red-500">*</span>
            </label>
            <select formControlName="paymentMode" class="form-field">
              <option value="Virement">{{ i18n.t('forms.bankTransfer') }}</option>
              <option value="Cheque">{{ i18n.t('forms.check') }}</option>
              <option value="EspÃ¨ces">{{ i18n.t('forms.cash') }}</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              {{ i18n.t('forms.transactionRef') }}
            </label>
            <input type="text" formControlName="transactionRef" class="form-field" placeholder="Ex: TRX-123456">
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              {{ i18n.t('forms.notes') }}
            </label>
            <textarea formControlName="notes" rows="3" class="form-field"></textarea>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="flex items-center justify-between pt-6 border-t">
        <button type="button" routerLink="/payment" class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all font-semibold">
          {{ i18n.t('forms.cancel') }}
        </button>
        <button type="submit" [disabled]="paymentForm.invalid || loading" class="px-8 py-3 bg-cnss-primary text-white rounded-lg hover:bg-opacity-90 transition-all font-semibold disabled:opacity-50 disabled:cursor-not-allowed flex items-center">
          <span *ngIf="loading" class="spinner-sm mr-2"></span>
          <span class="material-icons mr-2" *ngIf="!loading">save</span>
          {{ i18n.t('forms.registerPaymentBtn') }}
        </button>
      </div>
    </form>
  </div>
</app-main-layout>
